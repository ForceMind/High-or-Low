<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>çŒœå¤§å°ï½œHigh or Low</title>
<style>
  :root{
    --bg:#0f1220; --panel:#181c2f; --accent:#ffd54d; --muted:#9aa3b2; --win:#34c759; --lose:#ff3b30;
    --card:#ffffff; --card-border:#dfe3eb; --shadow:0 10px 24px rgba(0,0,0,.25);
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b0e1a,#12162a 40%,#0f1220);color:#e8ecf2;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:980px;margin:24px auto;padding:16px}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;gap:12px}
  .title{font-weight:800;font-size:20px;letter-spacing:.3px}
  .bank{display:flex;align-items:center;gap:8px;background:var(--panel);padding:10px 12px;border-radius:14px;box-shadow:var(--shadow)}
  .bank .label{color:var(--muted);font-size:12px}
  .bank .val{font-weight:700}
  .bank button{background:#273057;border:none;color:#fff;padding:6px 10px;border-radius:10px;cursor:pointer}
  .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:16px}
  @media (max-width:900px){ .grid{grid-template-columns:1fr} }
  .panel{background:var(--panel);border-radius:18px;padding:16px;box-shadow:var(--shadow)}
  .cards{display:flex;gap:16px;align-items:center;justify-content:center;padding:10px;min-height:220px}
  .card{
    width:130px;height:180px;border-radius:14px;border:1px solid var(--card-border);background:var(--card);
    color:#111;box-shadow:0 10px 24px rgba(18,22,42,.35);position:relative;user-select:none
  }
  .card.small{width:90px;height:130px}
  .rank{position:absolute;left:8px;top:6px;font-weight:800}
  .suit{position:absolute;right:8px;bottom:6px;font-size:20px}
  .center{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:40px}
  .red{color:#d61f45}
  .back{
    background:repeating-linear-gradient(45deg,#253057,#253057 8px,#1b2649 8px,#1b2649 16px);
    border:1px solid #405189;
  }
  .stack{display:flex;flex-direction:column;align-items:center;gap:8px}
  .stack .hint{font-size:12px;color:var(--muted)}
  .controls{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}
  .controls > div{background:#11162a;border-radius:14px;padding:12px}
  .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  input[type="number"]{width:120px;background:#0c1022;border:1px solid #2b345e;color:#e8ecf2;padding:8px 10px;border-radius:10px}
  .btn{background:#2a355f;border:none;color:#fff;padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:700}
  .btn.primary{background:#5668ff}
  .btn.big{padding:14px 16px;font-size:18px;border-radius:14px}
  .btn.good{background:var(--win)}
  .btn.bad{background:#ff784a}
  .btn:disabled{opacity:.55;cursor:not-allowed}
  .odds{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
  .odds .box{background:#0c1022;border:1px solid #2b345e;border-radius:12px;padding:10px 12px}
  .muted{color:var(--muted);font-size:12px}
  .bignum{font-weight:800;font-size:18px}
  .meta{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .tag{background:#0c1022;border:1px solid #2b345e;color:#cfd6e6;padding:6px 10px;border-radius:999px;font-size:12px}
  .log{max-height:180px;overflow:auto;padding-right:4px}
  .msg{padding:8px 10px;border-bottom:1px dashed #2b345e;font-size:13px;color:#d7def0}
  .msg.win{color:#b5ffd0}
  .msg.lose{color:#ffd0d0}
  footer{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
  .note{font-size:12px;color:#c9cfdd}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">çŒœå¤§å°ï½œHigh or Low</div>
      <div class="bank">
        <span class="label">ä½™é¢</span>
        <span class="val" id="balance">â€”</span>
        <button id="add100">+100</button>
        <button id="reset">é‡å¼€</button>
      </div>
    </header>

    <div class="grid">
      <!-- å·¦ä¾§ï¼šç‰Œæ¡Œ -->
      <section class="panel">
        <div class="cards">
          <div class="stack">
            <div class="hint">åŸºå‡†ç‰Œ</div>
            <div class="card" id="baseCard"></div>
          </div>
          <div class="stack">
            <div class="hint">å¾…çŒœç‰Œ</div>
            <div class="card back" id="nextCardBack"></div>
          </div>
          <div class="stack">
            <div class="hint">å‘ç‰Œå †</div>
            <div class="card small back"></div>
            <div class="muted" id="deckCount">å‰©ä½™ï¼šâ€”</div>
          </div>
          <div class="stack">
            <div class="hint">å¼ƒç‰Œå †</div>
            <div class="card small back" style="filter:grayscale(.5) brightness(.8)"></div>
            <div class="muted" id="discardCount">å¼ƒç‰Œï¼šâ€”</div>
          </div>
        </div>

        <div class="controls">
          <div>
            <div class="row">
              <label class="muted">ä¸‹æ³¨é‡‘é¢</label>
              <input id="bet" type="number" min="1" step="1" value="100" />
              <button class="btn" id="betPlus">+100</button>
              <button class="btn" id="betMax">å…¨æŠ¼</button>
            </div>
            <div class="odds">
              <div class="box">
                <div class="muted">çŒœå¤§ é¢„è®¡èµ”ç‡ï¼ˆå¥–é‡‘/ä¸‹æ³¨ï¼‰</div>
                <div class="bignum" id="oddBig">â€”</div>
                <div class="muted" id="probBig">æˆåŠŸæ¦‚ç‡ï¼šâ€”</div>
              </div>
              <div class="box">
                <div class="muted">çŒœå° é¢„è®¡èµ”ç‡ï¼ˆå¥–é‡‘/ä¸‹æ³¨ï¼‰</div>
                <div class="bignum" id="oddSmall">â€”</div>
                <div class="muted" id="probSmall">æˆåŠŸæ¦‚ç‡ï¼šâ€”</div>
              </div>
            </div>
            <div class="meta">
              <div class="tag">æŠ½æ°´ï¼š3%ï¼ˆÃ—0.97ï¼‰</div>
              <div class="tag">ç‚¹æ•°ï¼šA æœ€å°ï¼ŒK æœ€å¤§</div>
              <div class="tag">ç›¸åŒç‚¹æ•°ï¼å¹³å°èµ¢</div>
            </div>
          </div>
          <div>
            <div class="row" style="margin-bottom:8px">
              <button class="btn big good" id="guessBig">çŒœå¤§</button>
              <button class="btn big bad" id="guessSmall">çŒœå°</button>
            </div>
            <div class="row">
              <button class="btn primary" id="newRound">ä¸‹ä¸€è½®ï¼ˆç¿»é¢æŠ½ç‰Œï¼‰</button>
            </div>
            <div class="note" style="margin-top:8px">
              ä¸‹æ³¨æ—¶ä¼šå…ˆæ‰£é™¤ä¸‹æ³¨é‡‘é¢ï¼›è‹¥èƒœï¼Œå‘æ”¾å¥–é‡‘ = ä¸‹æ³¨ Ã— 0.97 Ã· æˆåŠŸæ¦‚ç‡ã€‚<br/>
              ï¼ˆæœŸæœ›å€¼ â‰ˆ -3%ï¼‰
            </div>
          </div>
        </div>
      </section>

      <!-- å³ä¾§ï¼šè®°å½• -->
      <section class="panel">
        <div class="muted" style="margin-bottom:8px">å¯¹å±€è®°å½•</div>
        <div class="log" id="log"></div>
      </section>
    </div>
  </div>

<script>
(function(){
  // â€”â€” åŸºç¡€æ•°æ®ä¸å·¥å…· â€”â€” //
  const SUITS = ["â™ ","â™¥","â™¦","â™£"];
  const RANKS = [1,2,3,4,5,6,7,8,9,10,11,12,13]; // A..K
  const HOUSE_EDGE = 0.97;

  const el = (id)=>document.getElementById(id);
  const fmt = (n)=> n.toLocaleString(undefined,{minimumFractionDigits:0,maximumFractionDigits:2});
  const rankLabel = (r)=> ({1:"A",11:"J",12:"Q",13:"K"}[r] || String(r));

  function buildDeck(){
    const deck=[];
    for(const s of SUITS){
      for(const r of RANKS){
        deck.push({suit:s, rank:r});
      }
    }
    return deck;
  }
  function shuffle(a){
    for(let i=a.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
  }
  function cardHTML(c){
    if(!c) return "";
    const red = (c.suit==="â™¥"||c.suit==="â™¦")?" red":"";
    return `
      <div class="rank${red}">${rankLabel(c.rank)}</div>
      <div class="center${red}">${c.suit}</div>
      <div class="suit${red}">${c.suit}</div>
    `;
  }

  // â€”â€” æ¸¸æˆçŠ¶æ€ â€”â€” //
  let deck=[], discard=[], baseCard=null, balance=1000;
  let roundLocked = false; // é˜²æ­¢é‡å¤ç‚¹å‡»
  init();

  function init(){
    deck = buildDeck();
    shuffle(deck);
    discard = [];
    baseCard = deck.pop();
    balance = 1000;
    roundLocked = false;
    renderAll();
  }

  function renderAll(){
    // åŸºå‡†ç‰Œ
    const base = el("baseCard");
    base.classList.remove("back");
    base.innerHTML = cardHTML(baseCard);

    // å¾…çŒœç‰Œæ˜¾ç¤ºèƒŒé¢å ä½
    const nextBack = el("nextCardBack");
    nextBack.classList.add("back");
    nextBack.innerHTML = "";

    // æ˜¾ç¤ºè®¡æ•°
    el("deckCount").textContent = `å‰©ä½™ï¼š${deck.length}`;
    el("discardCount").textContent = `å¼ƒç‰Œï¼š${discard.length}`;
    el("balance").textContent = `ï¿¥${fmt(balance)}`;

    // è®¡ç®—æ¦‚ç‡ä¸æŒ‰é’®å¯ç”¨æ€§
    updateOddsBoxes();

    // æ§ä»¶çŠ¶æ€
    el("guessBig").disabled = roundLocked || calcCounts().bigCount===0;
    el("guessSmall").disabled = roundLocked || calcCounts().smallCount===0;
  }

  function calcCounts(){
    // ç»Ÿè®¡åœ¨å½“å‰â€œå‘ç‰Œå †â€ä¸­ï¼Œæ¯”åŸºå‡†ç‰Œå¤§çš„/å°çš„/ç›¸åŒçš„æ•°é‡
    let big=0, small=0, equal=0;
    for(const c of deck){
      if(c.rank>baseCard.rank) big++;
      else if(c.rank<baseCard.rank) small++;
      else equal++;
    }
    const total = deck.length; // ç©å®¶å¯è§çš„æœªçŸ¥ç©ºé—´
    return {bigCount:big, smallCount:small, equalCount:equal, total};
  }

  function updateOddsBoxes(){
    const {bigCount, smallCount, total} = calcCounts();
    const pb = total>0 ? bigCount/total : 0;
    const ps = total>0 ? smallCount/total : 0;
    el("probBig").textContent   = `æˆåŠŸæ¦‚ç‡ï¼š${total? (pb*100).toFixed(2)+"%":"â€”"}`;
    el("probSmall").textContent = `æˆåŠŸæ¦‚ç‡ï¼š${total? (ps*100).toFixed(2)+"%":"â€”"}`;
    el("oddBig").textContent   = total && pb>0 ? `Ã— ${(HOUSE_EDGE/pb).toFixed(3)}` : "ä¸å¯é€‰";
    el("oddSmall").textContent = total && ps>0 ? `Ã— ${(HOUSE_EDGE/ps).toFixed(3)}` : "ä¸å¯é€‰";
  }

  function drawNextAndResolve(guess){ // guess: "big" | "small"
    if(roundLocked) return;
    const bet = getBet();
    if(bet<=0){ toast("è¯·è¾“å…¥æœ‰æ•ˆä¸‹æ³¨é‡‘é¢"); return; }
    if(bet>balance){ toast("ä½™é¢ä¸è¶³"); return; }
    if(deck.length<=0){
      reshuffleFromDiscard();
      if(deck.length<=0){ toast("ç‰Œå †ä¸è¶³ï¼Œæ— æ³•ç»§ç»­"); return; }
    }

    // ä¸‹æ³¨å…ˆæ‰£æ¬¾
    balance -= bet;

    // åŸºäºå½“å‰å¯è§ç‰Œå †ï¼Œè®°å½•å½“ä¸‹çš„æˆåŠŸæ¦‚ç‡ï¼ˆç”¨äºè®¡ç®—å¥–é‡‘ï¼‰
    const {bigCount, smallCount, total} = calcCounts();
    const p = (guess==="big") ? (bigCount/total) : (smallCount/total);
    if(!(p>0)){ toast("æ­¤æ–¹å‘æ²¡æœ‰å¯èµ¢ç‰Œ"); renderAll(); return; }

    // æŠ½ä¸€å¼ ä½œä¸ºâ€œå¾…çŒœç‰Œâ€çš„çœŸå€¼
    const drawn = deck.pop();

    // ç¿»å¼€åŠ¨ç”»ï¼ˆç®€å•å»¶è¿Ÿæ¨¡æ‹Ÿï¼‰
    roundLocked = true;
    flipNextCardFace(drawn);

    // åˆ¤å®šè¾“èµ¢
    const cmp = (drawn.rank===baseCard.rank) ? 0 : (drawn.rank>baseCard.rank ? 1 : -1);
    let win = false;
    if(cmp===0){ win=false; } // ç›¸åŒï¼å¹³å°èµ¢
    else if(guess==="big")  win = (cmp===1);
    else if(guess==="small")win = (cmp===-1);

    // è®¡ç®—å¥–é‡‘ï¼šèµ¢å–é‡‘é¢ = ä¸‹æ³¨ Ã— 0.97 Ã· æˆåŠŸæ¦‚ç‡
    const prize = win ? bet * HOUSE_EDGE / p : 0;

    // ç»“ç®—ä¸æ—¥å¿—
    setTimeout(()=>{
      if(win){
        balance += prize;
        log(`èµ¢ âœ…  åŸºå‡† ${rankLabel(baseCard.rank)} ä¸ æŠ½åˆ° ${rankLabel(drawn.rank)}ï¼Œæ–¹å‘ï¼š${guess==='big'?'å¤§':'å°'}ï¼Œè·å¾—å¥–é‡‘ ï¿¥${fmt(prize)}ï¼ˆæ‰£é™¤ä¸‹æ³¨ï¿¥${fmt(bet)}å·²å…ˆè¡Œï¼‰`, true);
      }else{
        log(`è¾“ âŒ  åŸºå‡† ${rankLabel(baseCard.rank)} ä¸ æŠ½åˆ° ${rankLabel(drawn.rank)}ï¼Œæ–¹å‘ï¼š${guess==='big'?'å¤§':'å°'}ï¼Œç›¸åŒæˆ–åˆ¤æ–­é”™è¯¯ï¼ŒæŸå¤± ï¿¥${fmt(bet)}`, false);
      }

      // å›åˆæ”¶å°¾ï¼šæ—§åŸºå‡†å…¥å¼ƒç‰Œï¼Œæ–°åŸºå‡†=æœ¬æ¬¡æŠ½åˆ°
      discard.push(baseCard);
      baseCard = drawn;

      // å¼ƒç‰Œè¾¾ 25 é‡æ´—
      if(discard.length>=25){ reshuffleFromDiscard(); }

      roundLocked = false;
      renderAll();
    }, 450);
  }

  function reshuffleFromDiscard(){
    // å°†å¼ƒç‰Œå †ä¸â€œå½“å‰å‘ç‰Œå †â€åˆå¹¶é‡æ´—ï¼ˆä¸åŒ…å«å°é¢ä¸Šçš„åŸºå‡†ç‰Œï¼‰
    const merged = deck.concat(discard);
    if(merged.length===0) return;
    shuffle(merged);
    deck = merged;
    discard = [];
    log(`ğŸ”„ å¼ƒç‰Œè¾¾ 25 æˆ–éœ€è¦è¡¥ç‰Œï¼Œå·²ä¸å‘ç‰Œå †åˆå¹¶é‡æ´—ï¼ˆä¸å«å½“å‰åŸºå‡†ç‰Œï¼‰ã€‚`);
  }

  function flipNextCardFace(card){
    const box = el("nextCardBack");
    box.classList.remove("back");
    box.innerHTML = cardHTML(card);
  }

  function getBet(){
    const v = Number(el("bet").value || 0);
    return Math.max(0, Math.floor(v));
  }

  function log(text, winFlag){
    const row = document.createElement("div");
    row.className = "msg" + (winFlag===true?" win": (winFlag===false?" lose":""));
    row.textContent = text;
    const logBox = el("log");
    logBox.prepend(row);
    // é™åˆ¶è®°å½•é•¿åº¦
    while(logBox.children.length>200) logBox.removeChild(logBox.lastChild);
  }

  function toast(msg){
    log(msg);
  }

  // â€”â€” äº‹ä»¶ç»‘å®š â€”â€” //
  el("guessBig").addEventListener("click", ()=>drawNextAndResolve("big"));
  el("guessSmall").addEventListener("click", ()=>drawNextAndResolve("small"));

  el("newRound").addEventListener("click", ()=>{
    // æ‰‹åŠ¨è¿›å…¥ä¸‹ä¸€è½®ï¼šç¿»é¢åŠ¨ç”»æ•ˆæœï¼ˆä»…é‡ç½®å ä½ï¼‰ï¼Œä¸æŠ½ç‰Œ
    roundLocked = false;
    const nextBack = el("nextCardBack");
    nextBack.classList.add("back");
    nextBack.innerHTML = "";
  });

  el("reset").addEventListener("click", ()=>{
    init();
    log("ğŸ” æ¸¸æˆå·²é‡å¼€ã€‚");
  });

  el("add100").addEventListener("click", ()=>{
    balance += 100;
    renderAll();
  });

  el("betPlus").addEventListener("click", ()=>{
    el("bet").value = String(getBet()+100);
    updateOddsBoxes();
  });

  el("betMax").addEventListener("click", ()=>{
    el("bet").value = String(Math.max(1, Math.floor(balance)));
    updateOddsBoxes();
  });

  el("bet").addEventListener("input", updateOddsBoxes);

})();
</script>
</body>
</html>
